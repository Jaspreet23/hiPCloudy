const hip = require('./hip-requests.js');
const accounts = process.argv;
const d = new Date();

hip.postJobOptions(hip.randomCategory(), '7467 - Queenstown', 3, '04000000', `hiptest+${Math.round(d.getTime() / 1000)}@mailinator.com`, 'API Test', true, false, false, (res) => {
  hip.postJob(res, (jobId) => {
    hip.setCookie(() => {
      let completed = 2;
      for (let i = 2; i < accounts.length; i++)			{
        hip.createAssignments(hip.cookie, jobId, accounts[i], () => {
          completed++;
          if (completed === accounts.length) {
            hip.invite(hip.cookie, jobId, false, () => {
              console.log(`${hip.appUrl}?m=jobs&a=view_assignments&job_id=${jobId}`);
            });
          }
        });
      }
    });
  });
});
